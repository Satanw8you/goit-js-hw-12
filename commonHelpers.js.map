{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst form = document.querySelector('.form');\nconst list = document.querySelector('.image-list');\nconst span = document.querySelector('.loader');\nconst loadBtn = document.querySelector('.load-button');\nconst secondaryLoader = document.querySelector('.sec-loader');\n\nspan.style.display = 'none';\nsecondaryLoader.style.display = 'none';\nloadBtn.style.display = 'none';\nform.addEventListener('submit', handleSearchOnForm);\nloadBtn.addEventListener('click', loadMoreImages);\n\nconst queryParams = {\n  currentPage: 1,\n  pageSize: 40,\n  refreshPage: '',\n  inputValue: '',\n};\n\nfunction handleSearchOnForm(event) {\n  event.preventDefault();\n  list.innerHTML = '';\n  span.style.display = 'block';\n  loadBtn.style.display = 'none';\n  queryParams.inputValue = event.target.elements.input.value.trim();\n  if (!queryParams.inputValue) {\n    iziToast.warning({\n      title: 'Caution',\n      message: 'Sorry, you have not entered anything in the search',\n    });\n    span.style.display = 'none';\n    return;\n  }\n  queryParams.currentPage = 1;\n  fetchImages(queryParams.inputValue, queryParams.currentPage)\n    .then(({ data }) => {\n      span.style.display = 'none';\n      const totalPages = Math.ceil(data.totalHits / queryParams.pageSize);\n      if (queryParams.currentPage === totalPages) {\n        loadBtn.style.display = 'none';\n      } else {\n        loadBtn.style.display = 'block';\n      }\n      if (!data || data.totalHits === 0) {\n        iziToast.error({\n          title: 'Error',\n          message:\n            'Sorry, there are no images matching your search query. Please try again!',\n        });\n      }\n      list.insertAdjacentHTML('beforeend', createMarkup(data.hits));\n      queryParams.refreshPage = new SimpleLightbox('.image-list a', {\n        captions: true,\n        captionsData: 'alt',\n        captionDelay: 250,\n      });\n      queryParams.refreshPage.refresh();\n      form.reset();\n    })\n    .catch(error => {\n      span.style.display = 'none';\n      console.log(error);\n    });\n}\n\nasync function fetchImages(name, page) {\n  const BASE_URL = 'https://pixabay.com/api/';\n  const API_KEY = '41847717-e04c221e42f4fa0d8db3b7e62';\n  try {\n    const response = await axios.get(BASE_URL, {\n      params: {\n        key: API_KEY,\n        q: name,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        page: page,\n        per_page: 40,\n      },\n    });\n    return response;\n  } catch {\n    iziToast.error({\n      title: 'Error',\n      message: 'Sorry! The site is currently unavailable. Please try later!',\n    });\n    console.error(error);\n  }\n}\n\nasync function loadMoreImages() {\n  queryParams.currentPage += 1;\n  secondaryLoader.style.display = 'block';\n  loadBtn.style.display = 'none';\n  const getImgHeight = () =>\n    document.querySelector('.image-list-item').getBoundingClientRect();\n  try {\n    const { data } = await fetchImages(\n      queryParams.inputValue,\n      queryParams.currentPage\n    );\n    if (data.totalHits === 0) {\n      iziToast.warning({\n        title: 'Caution',\n        message: 'No matching images found.',\n      });\n      loadBtn.style.display = 'none';\n      secondaryLoader.style.display = 'none';\n      return;\n    }\n    list.insertAdjacentHTML('beforeend', createMarkup(data.hits));\n    window.scrollBy({\n      top: getImgHeight().height * 2,\n      left: 0,\n      behavior: 'smooth',\n    });\n    queryParams.refreshPage.refresh();\n    const totalPages = Math.ceil(data.totalHits / queryParams.pageSize);\n    if (queryParams.currentPage === totalPages) {\n      iziToast.info({\n        title: 'Caution',\n        message: `We're sorry, but you've reached the end of search results.`,\n      });\n      loadBtn.style.display = 'none';\n      secondaryLoader.style.display = 'none';\n      loadBtn.removeEventListener('click', loadMoreImages);\n      return;\n    }\n    secondaryLoader.style.display = 'none';\n    loadBtn.style.display = 'block';\n  } catch (error) {\n    console.log(error);\n  }\n}\n\nfunction createMarkup(array) {\n  return array\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `<li class=\"image-list-item\">\n          <a href=\"${largeImageURL}\" class=\"list-image-link\">\n            <img class=\"list-image\" src=\"${webformatURL}\" alt=\"${tags}\" />\n          </a>\n          <div class=\"image-wrapper\">\n            <ul class=\"desc-list\">\n              <li class=\"desc-item\">\n                <h2 class=\"desc-title\">Likes</h2>\n                <p class=\"desc-text\">${likes}</p>\n              </li>\n              <li class=\"desc-item\">\n                <h2 class=\"desc-title\">Views</h2>\n                <p class=\"desc-text\">${views}</p>\n              </li>\n              <li class=\"desc-item\">\n                <h2 class=\"desc-title\">Comments</h2>\n                <p class=\"desc-text\">${comments}</p>\n              </li>\n              <li class=\"desc-item\">\n                <h2 class=\"desc-title\">Downloads</h2>\n                <p class=\"desc-text\">${downloads}</p>\n              </li>\n            </ul>\n          </div>\n        </li>`\n    )\n    .join('');\n}\n"],"names":["form","list","span","loadBtn","secondaryLoader","handleSearchOnForm","loadMoreImages","queryParams","event","iziToast","fetchImages","data","totalPages","createMarkup","SimpleLightbox","error","name","page","BASE_URL","API_KEY","axios","getImgHeight","array","webformatURL","largeImageURL","tags","likes","views","comments","downloads"],"mappings":"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"}